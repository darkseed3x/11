<?xml version="1.0" encoding="UTF-8"?>
<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="Test" searchProperties="true" id="ceb0d507-ab83-407a-8323-c9eec509e016" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="ceb0d507-ab83-407a-8323-c9eec509e016fileName">Test</con:setting></con:settings><con:testStep type="calltestcase" name="setupprop" id="2e98f235-41ab-48a0-a597-bb7fbe3c3287" disabled="true"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>7e5cda9a-de60-4865-b480-74309741c59f</con:targetTestCase><con:properties/><con:returnProperties/><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="groovy" name="SetGlobal" id="0cc16cb0-a44a-46a5-8989-15858b01e2e5"><con:settings/><con:config><script>def N = context.expand( '${#TestCase#N}' )
testRunner.testCase.setPropertyValue("N", "1" )
</script></con:config></con:testStep><con:testStep type="groovy" name="GetSim" id="effdc3cd-6bfa-4fc2-acd2-122d3243390e"><con:settings/><con:config><script>def path = context.expand( '${#TestCase#Path}' )
def sim = context.expand( '${#TestCase#sim}' )
testRunner.testCase.setPropertyValue("temp", '' )   
def icc_id = ''

def t = new File(path+'1.txt').eachLine { line ->
if ((line == sim)) {   }
else{
	icc_id = context.expand( '${#TestCase#temp}' )
testRunner.testCase.setPropertyValue("sim", line )   
 testRunner.testCase.setPropertyValue("temp",  icc_id + '\n'+ line )
}
}

def out=new File(path+'1.txt')
out.delete()
def temp = context.expand( '${#TestCase#temp}' )
out &lt;&lt; temp

</script></con:config></con:testStep><con:testStep type="request" name="ISSIM" id="a2c0d3dd-1399-476e-af8d-d73aaf5e997b"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>InventorySOAPBinding</con:interface><con:operation>GetSIMInformation</con:operation><con:request name="ISSIM" id="96c11ad6-a343-498d-8e50-bc4ad017e6a4"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2c}-jservice.g4lab.com:8080/inventory-ejb/Inventory/InventoryServiceBean</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:inv="http://www.yota.ru/vox/services/inventory">
   <soapenv:Header/>
   <soapenv:Body>
      <inv:GetSIMInformationRequest>
         <simCode>
            <key>${#TestCase#sim}</key>
            <type>iccid</type>
         </simCode>
      </inv:GetSIMInformationRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="8a160296-fd42-4ec2-851b-79569cd44c59"/><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="checkIS" id="fd6469c8-2280-4095-b22f-fd9488f51585"><con:settings/><con:config><script>def simtype = context.expand( '${ISSIM#Response#declare namespace ns5=\'http://www.yota.ru/vox/services/inventory\'; //ns5:GetSIMInformationResponse[1]/sim[1]/simSpec[1]}' )
 
 if (simtype != 'PHONE-001')
{
  testRunner.gotoStepByName("GetSim")
}</script></con:config></con:testStep><con:testStep type="groovy" name="checkIS2" id="4f6adeac-283d-4b4a-a914-d475d9f2e118"><con:settings/><con:config><script>def vacant = context.expand( '${ISSIM#Response#declare namespace ns5=\'http://www.yota.ru/vox/services/inventory\'; declare namespace xsi=\'http://www.w3.org/2001/XMLSchema-instance\'; //ns5:GetSIMInformationResponse[1]/sim[1]/@xsi:type}' )

  if (vacant != 'ns7:VacantSim')
{
  testRunner.gotoStepByName("GetSim")
}</script></con:config></con:testStep><con:testStep type="request" name="cams" id="3c1ebd75-76e2-4203-a283-43f8092f2d11"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CustomerAccountServiceSOAPBinding</con:interface><con:operation>checkSimAvailability</con:operation><con:request name="cams" id="4742b98a-3af7-4abd-a0ec-a77ffebfeb3b"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2b}-esb1.g4lab.com:8315/CustomerAccountManagementService</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cus="http://www.yota.ru/vox/b2b/services/customerAccount">
   <soapenv:Header/>
   <soapenv:Body>
      <cus:CheckSimAvailabilityRequest>
         <iccid>${#TestCase#sim}</iccid>
      </cus:CheckSimAvailabilityRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="3f1bab96-724d-40a0-825f-90bf27fcb39f"/><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="checkCams" id="96529554-19e8-40e7-8e38-de45099282ae"><con:settings/><con:config><script>def checksim = context.expand( '${cams#Response#declare namespace ns0=\'http://www.yota.ru/vox/b2b/services/customerAccount\'; //ns0:CheckSimAvailabilityResponse[1]/validationResult[1]}' )

 if (checksim != 'true')
{
  testRunner.gotoStepByName("GetSim")
}</script></con:config></con:testStep><con:testStep type="httprequest" name="delSub" id="08838a33-8ffd-40e5-a884-3cae6851784a"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" name="delSub" id="85524a05-ffd8-43c0-a380-3e9cb88b170e" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://${#Project#pcrf}.g4lab.com/spr/sm/deleteSubscriber</con:endpoint><con:request/><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>id</con:name><con:value>25011${#TestCase#sim}</con:value><con:style>QUERY</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default>250110200201504</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="httprequest" name="addSub" id="b7a508e2-82b1-4a87-af99-185bdc964b12"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" name="addSub" id="682616d7-64ba-4f52-8489-c94858ea34cd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://${#Project#pcrf}.g4lab.com/spr/sm/addSubscriber</con:endpoint><con:request/><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>id</con:name><con:value>25011${#TestCase#sim}</con:value><con:style>QUERY</con:style><con:type xmlns:xs="http://www.w3.org/2001/XMLSchema">xs:string</con:type><con:default>250110200201504</con:default><con:path xsi:nil="true"/><con:description xsi:nil="true"/></con:parameter></con:parameters></con:config></con:testStep><con:testStep type="request" name="extradition" id="36efc05b-e029-4330-97f4-b482cb27af00"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorporateOrderManagementServiceSOAPBinding</con:interface><con:operation>createOrder</con:operation><con:request name="extradition" id="2eedb4ba-d0ce-486d-89b2-5b5e25b90513"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://10.90.253.243:8082/oms-web/OrderEndpoint</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ord="http://www.yota.ru/vox/b2b/services/order">
   <soapenv:Header/>
   <soapenv:Body>
      <ord:CreateOrderRequest>
         <order createChannel="RemoteDealer" orderStatus="complete" orderStep="initialization" orderType="SIMOrder" updateChannel="RemoteDealer">
            <billingAccount>${#TestCase#BillingID}</billingAccount>
            <orderChangeDate>2016-04-06T14:04:15.511+03:00</orderChangeDate>
            <orderContent xsi:type="ns641:SIMOrder" xmlns:ns641="http://www.yota.ru/vox/b2b/domains/corpSIMOrder" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
               <deliveredSims><branch/><simSpec/><iccid>${#TestCase#sim}</iccid>
                  <saleChannel>RemoteDealer</saleChannel>
               </deliveredSims>
            </orderContent>
         </order>
      </ord:CreateOrderRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="6eae11b6-d9c3-4d33-af80-95e0bbe7e8d6"/><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="checkExtradition" id="84fd951c-b209-4ad1-8e76-012b317b37a5"><con:settings/><con:config><script>def ok = context.expand( '${extradition#Response#declare namespace ns2=\'http://www.yota.ru/vox/b2b/services/order\'; //ns2:CreateOrderResponse[1]/@resultStatus}' )

 if (ok != 'new')
{
  testRunner.gotoStepByName("GetSim")
}</script></con:config></con:testStep><con:testStep type="request" name="activsoim" id="f9b08067-4e97-4b36-afc5-2f156433f51c" disabled="true"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorporateOrderManagementServiceSOAPBinding</con:interface><con:operation>createOrder</con:operation><con:request name="activsoim" id="c760aa37-743c-491a-b746-3159752adc0a"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://10.90.253.243:8082/oms-web/OrderEndpoint</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ord="http://www.yota.ru/vox/b2b/services/order">
   <soapenv:Header/>
   <soapenv:Body>
      <ord:CreateOrderRequest>
         <order createChannel="RemoteDealer" orderStatus="complete" orderStep="initialization" orderType="SIMActivation" updateChannel="RemoteDealer"><orderChangeDate>2017-01-19T00:00:00.000+04:00</orderChangeDate><billingAccount>${#TestCase#BillingID}</billingAccount><orderContent xsi:type="ns577:SIMActivationOrder" xmlns:ns677="http://www.yota.ru/vox/b2b/domains/corpSIMOrder" xmlns:ns577="http://www.yota.ru/vox/b2b/domains/order" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  
<activatedUnits><sim><branch/><simCodes><key>${#TestCase#sim}</key><type>iccid</type></simCodes><simSpec/></sim></activatedUnits></orderContent></order>
      </ord:CreateOrderRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="cd0b2d60-7c07-44a2-b40b-391837a94774"/><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="List" id="8f430e61-9135-4d69-8054-0c430dd6dc90"><con:settings/><con:config><script><![CDATA[def  icc_id = context.expand( '${#TestCase#sim}' )
def billingid = context.expand( '${#TestCase#BillingID}' )
def path = context.expand( '${#TestCase#Path}' )
def startDate = new Date() 
def hostb2b = context.expand( '${#Project#host-b2b}' )
def hostb2c = context.expand( '${#Project#host-b2c}' )
def customerid = context.expand( '${checkExt#Response#declare namespace ns10=\'http://www.yota.ru/vox/b2b/services/customerInformation\'; //ns10:GetCustomerByICCIDResponse[1]/customer[1]/@customerId}' )
def phone = context.expand( '${checkExt#Response#declare namespace ns10=\'http://www.yota.ru/vox/b2b/services/customerInformation\'; //ns10:GetCustomerByICCIDResponse[1]/customer[1]/CEO[1]/phones[1]/phoneNumber[1]}' )

def out= new File(path+'SimIssuedToThe'+billingid+'.txt')
if(!out.exists()) {
    out.createNewFile()
    out <<  '\n' +"Дата создания: "+startDate.format("yyyy-MM-dd'T'HH:mm:ss")  
    out <<  '\n'
    out <<  '\n' + "Окружение: "+ hostb2b + " и " + hostb2c
    out <<  '\n'
    out <<  '\n' + "Номер договора абонента: " + billingid
    out <<  '\n'
    out <<  '\n' + "Номер телефона абонента: " + phone
    out <<  '\n'
    out <<  '\n' + "customerid: " + customerid
    out <<  '\n'
    out <<  '\n' +"Дата выдачи: "+startDate.format("yyyy-MM-dd'T'HH:mm:ss")  +  " | ICCID: " + icc_id + " | IMSI: 25011"+ icc_id
} else   out << '\n'+ "Дата выдачи: "+startDate.format("yyyy-MM-dd'T'HH:mm:ss")  +  " | ICCID: " + icc_id + " | IMSI: 25011"+ icc_id


]]></script></con:config></con:testStep><con:testStep type="groovy" name="checkCount" id="f451a462-7f31-4e87-8237-a604fe074a41"><con:settings/><con:config><script>def N = context.expand( '${#TestCase#N}' )

def SIMCount = context.expand( '${#TestCase#SIMCount}' )
 if (N != SIMCount)
{
	N = N.toInteger() + 1

	testRunner.testCase.setPropertyValue("N", N.toString() )

  testRunner.gotoStepByName("GetSim")
}</script></con:config></con:testStep><con:loadTest name="LoadTest 1" id="a1aa6c32-b1bb-49a9-b0e2-33d737107824"><con:settings><con:setting id="HttpSettings@close-connections">false</con:setting></con:settings><con:threadCount>5</con:threadCount><con:startDelay>0</con:startDelay><con:sampleInterval>250</con:sampleInterval><con:calculateTPSOnTimePassed>true</con:calculateTPSOnTimePassed><con:resetStatisticsOnThreadCountChange>true</con:resetStatisticsOnThreadCountChange><con:historyLimit>-1</con:historyLimit><con:testLimit>600</con:testLimit><con:limitType>TIME</con:limitType><con:loadStrategy><con:type>Simple</con:type></con:loadStrategy><con:assertion type="Step Status" name="Step Status"/><con:maxAssertionErrors>100</con:maxAssertionErrors><con:cancelExcessiveThreads>true</con:cancelExcessiveThreads><con:strategyInterval>500</con:strategyInterval><con:reportParameters/></con:loadTest><con:properties><con:property><con:name>SIMCount</con:name><con:value>5</con:value></con:property><con:property><con:name>N</con:name><con:value>1</con:value></con:property><con:property><con:name>Path</con:name><con:value>C:\Projects\!B2BTXT</con:value></con:property><con:property><con:name>BillingID</con:name><con:value>11220023967223</con:value></con:property><con:property><con:name>sim</con:name><con:value>0200185966</con:value></con:property><con:property><con:name>temp</con:name><con:value/></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>18ede8e0-c948-4be5-9a01-faf62475ce23</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>17a458cb-d50c-466e-b37e-bf9afe1e3511</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ccd84e25-12fb-4a73-a718-9911f3b695c3</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>5c4490e6-8cd7-4d22-b335-502b53285fb9</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>701b8157-653c-4182-be99-323c9801a764</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3287b16b-18ad-4996-b38c-9dd51b0c782e</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>6cbd5d5e-e099-458b-96ca-fafa3ae8a4fe</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>90778662-8176-48ff-b262-c968c1bb6d60</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d068ea3d-610d-45b8-a6ad-9ad3ab9a456b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>effdc3cd-6bfa-4fc2-acd2-122d3243390e</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase>