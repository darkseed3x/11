<?xml version="1.0" encoding="UTF-8"?>
<con:testCase id="62908315-44a2-40ad-812a-dad6b3bca4b3" failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="B2bboxRest_10" searchProperties="true" disabled="true" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="62908315-44a2-40ad-812a-dad6b3bca4b3fileName">B2bboxRest_10</con:setting></con:settings><con:testStep type="groovy" name="setPropertiess" id="a815f6eb-fa75-4ee6-a526-4206147bfe8e"><con:settings/><con:config><script>import javax.swing.*

def map = testRunner.testCase.getProperties()
def t= map.each{
    key, value -> testRunner.testCase.setPropertyValue(key, "")
}

testRunner.testCase.setPropertyValue('N', "0");
testRunner.testCase.setPropertyValue('path', "C:/Projects/");
testRunner.testCase.setPropertyValue('SIMCount', "10");


</script></con:config></con:testStep><con:testStep type="calltestcase" name="getVacantSim" id="26891cf8-aecb-40a2-95a4-55b79babd1bc"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>f076452a-212f-4fee-921e-2d23f29a3408</con:targetTestCase><con:properties><con:property><con:name>iccid</con:name><con:value>0200442888</con:value></con:property><con:property><con:name>imsi</con:name><con:value>250110200442888</con:value></con:property><con:property><con:name>ip</con:name><con:value>10.25.159.185</con:value></con:property></con:properties><con:returnProperties><con:entry>iccid</con:entry><con:entry>imsi</con:entry><con:entry>ip</con:entry></con:returnProperties><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="groovy" name="checkSim" id="761ae592-3348-4e48-bbc1-d7e14ed72a8c"><con:settings/><con:config><script>int N = context.expand( '${#TestCase#N}' ).toInteger()
String icc_id = context.expand( '${getVacantSim#iccid}' )


for(int i = 1; i &lt;= N; i++){
	String iccid = context.expand( '${#TestCase#iccid'+i+'}' )
	log.info(iccid)
	if(iccid.equals(icc_id)){
		testRunner.gotoStepByName("getVacantSim")
		break;
	}
	
}</script></con:config></con:testStep><con:testStep type="groovy" name="add iccid" id="49810175-372d-491f-8666-67045cd4b88a"><con:settings/><con:config><script>int N = context.expand( '${#TestCase#N}' ).toInteger()
int SIMCount = context.expand( '${#TestCase#SIMCount}' ).toInteger()
def icc_id = context.expand( '${getVacantSim#iccid}' )
def ip = context.expand( '${getVacantSim#ip}' )

	N++
	def iccidName = "iccid" + N
	def ipName = "ip" + N
	
	testRunner.testCase.setPropertyValue(ipName, ip);
	testRunner.testCase.setPropertyValue(iccidName,  icc_id);
	testRunner.testCase.setPropertyValue("N", N.toString() )
	
	 if (N &lt; SIMCount){
	 	
		testRunner.gotoStepByName("getVacantSim")
	}</script></con:config></con:testStep><con:testStep type="groovy" name="buildJson" id="4130fa5d-c6bf-41c8-9ba3-9052a51b676c"><con:settings/><con:config><script>import groovy.json.JsonBuilder 
import groovy.json.JsonOutput 

def testRequest = context.testCase.testSteps["B_2_B_BOX_order"].testRequest
def request = testRequest.requestContent;

def SIMCount = context.expand( '${#TestCase#SIMCount}' ).toInteger()

def iccidBlock =[]


for(int i = 1; i &lt;= SIMCount; i++){
	iccidBlock.add('${#TestCase#iccid' + i + '}')
def iccid1 = context.expand( '${#TestCase#iccid1}' )
	}

JsonBuilder builder = new JsonBuilder()
builder.order {
        createChannel 'PUBLIC_PORTAL'
        orderStatus 'INITIATE'
        orderStep 'INITIALIZATION'
        orderType 'B_2_B_BOX'
        updateChannel 'PUBLIC_PORTAL'
        orderContent{
        		B2BBoxOrder {
        				delivery 'false'
        				iccid (iccidBlock)
        		}
        }     
}



String json = JsonOutput.prettyPrint(builder.toString())
testRequest.setRequestContent(json);
</script></con:config></con:testStep><con:testStep type="restrequest" name="B_2_B_BOX_order" id="5a6288ad-5274-435b-bb18-5be1b2937df8"><con:settings/><con:config service="Corporate Order Management Service (CorpOMS)" resourcePath="/coms-web/api/createOrder" methodName="createOrder" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="B_2_B_BOX_order" id="978de5b9-fe46-4a0d-870c-8ad76d390f25" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://${#Project#host-b2b-rest}:8062</con:endpoint><con:request>{
    "order": {
        "createChannel": "PUBLIC_PORTAL",
        "orderStatus": "INITIATE",
        "orderStep": "INITIALIZATION",
        "orderType": "B_2_B_BOX",
        "updateChannel": "PUBLIC_PORTAL",
        "orderContent": {
            "B2BBoxOrder": {
                "delivery": "false",
                "iccid": [
                    "${#TestCase#iccid1}",
                    "${#TestCase#iccid2}",
                    "${#TestCase#iccid3}",
                    "${#TestCase#iccid4}",
                    "${#TestCase#iccid5}",
                    "${#TestCase#iccid6}",
                    "${#TestCase#iccid7}",
                    "${#TestCase#iccid8}",
                    "${#TestCase#iccid9}",
                    "${#TestCase#iccid10}",
                    "${#TestCase#iccid11}",
                    "${#TestCase#iccid12}",
                    "${#TestCase#iccid13}",
                    "${#TestCase#iccid14}",
                    "${#TestCase#iccid15}",
                    "${#TestCase#iccid16}",
                    "${#TestCase#iccid17}",
                    "${#TestCase#iccid18}",
                    "${#TestCase#iccid19}",
                    "${#TestCase#iccid20}"
                ]
            }
        }
    }
}</con:request><con:originalUri>http://DEV-b2b-ainst1.scartel.dc/coms-web/api/createOrder</con:originalUri><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters/></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="setBoxProp" id="b4cf2115-fd51-473a-a76b-d8af641f8eba"><con:settings/><con:config><script>def orderId = context.expand( '${B_2_B_BOX_order#Response#$.order.orderId}' )

testRunner.testCase.setPropertyValue( "box",orderId);
</script></con:config></con:testStep><con:testStep type="groovy" name="Copy of Copy of List" id="04588da5-08e8-4b36-90c9-e89435f837e3" disabled="true"><con:settings/><con:config><script>
def path = context.expand( '${#TestCase#Path}' )
def startDate = new Date()
def orderId = context.expand( '${B_2_B_BOX_order#Response#$.order.orderId}' )

def out= new File(path+'B2BBOX'+orderId+'.txt')
int counter = context.expand( '${#TestCase#SIMCount}' ).toInteger()

for(int i = 1; i&lt;=counter; i++){
	
	def iccid = context.expand( '${#TestCase#iccid'+i+'}' )
	 out &lt;&lt; '\n'+ "Дата выдачи: "+startDate.format("yyyy-MM-dd'T'HH:mm:ss")  +  " | ICCID: " + iccid + " | IMSI: 25011"+ iccid + " | OrderID: " + orderId 
	}
	





    </script></con:config></con:testStep><con:properties><con:property><con:name>iccid</con:name><con:value/></con:property><con:property><con:name>imsi</con:name><con:value/></con:property><con:property><con:name>box</con:name><con:value/></con:property><con:property><con:name>N</con:name><con:value>7</con:value></con:property><con:property><con:name>SIMCount</con:name><con:value>10</con:value></con:property><con:property><con:name>path</con:name><con:value>C:/Projects/</con:value></con:property><con:property><con:name>iccid1</con:name><con:value>0200445376</con:value></con:property><con:property><con:name>iccid2</con:name><con:value>0200443932</con:value></con:property><con:property><con:name>iccid3</con:name><con:value>0200443920</con:value></con:property><con:property><con:name>iccid4</con:name><con:value>0200443093</con:value></con:property><con:property><con:name>iccid5</con:name><con:value>0200444774</con:value></con:property><con:property><con:name>iccid6</con:name><con:value>0200443947</con:value></con:property><con:property><con:name>iccid7</con:name><con:value>0200443489</con:value></con:property><con:property><con:name>iccid8</con:name><con:value/></con:property><con:property><con:name>iccid9</con:name><con:value/></con:property><con:property><con:name>iccid10</con:name><con:value/></con:property><con:property><con:name>iccid11</con:name><con:value/></con:property><con:property><con:name>iccid12</con:name><con:value/></con:property><con:property><con:name>iccid13</con:name><con:value/></con:property><con:property><con:name>iccid14</con:name><con:value/></con:property><con:property><con:name>iccid15</con:name><con:value/></con:property><con:property><con:name>iccid16</con:name><con:value/></con:property><con:property><con:name>iccid17</con:name><con:value/></con:property><con:property><con:name>iccid18</con:name><con:value/></con:property><con:property><con:name>iccid19</con:name><con:value/></con:property><con:property><con:name>iccid20</con:name><con:value/></con:property><con:property><con:name>ip1</con:name><con:value>10.74.252.130</con:value></con:property><con:property><con:name>ip2</con:name><con:value>10.20.33.152</con:value></con:property><con:property><con:name>ip3</con:name><con:value>10.214.247.29</con:value></con:property><con:property><con:name>ip4</con:name><con:value>10.84.1.136</con:value></con:property><con:property><con:name>ip5</con:name><con:value>10.177.12.98</con:value></con:property><con:property><con:name>ip6</con:name><con:value>10.88.104.20</con:value></con:property><con:property><con:name>ip7</con:name><con:value>10.84.143.169</con:value></con:property><con:property><con:name>ip8</con:name><con:value/></con:property><con:property><con:name>ip9</con:name><con:value/></con:property><con:property><con:name>ip10</con:name><con:value/></con:property><con:property><con:name>ip11</con:name><con:value/></con:property><con:property><con:name>ip12</con:name><con:value/></con:property><con:property><con:name>ip13</con:name><con:value/></con:property><con:property><con:name>ip14</con:name><con:value/></con:property><con:property><con:name>ip15</con:name><con:value/></con:property><con:property><con:name>ip16</con:name><con:value/></con:property><con:property><con:name>ip17</con:name><con:value/></con:property><con:property><con:name>ip18</con:name><con:value/></con:property><con:property><con:name>ip19</con:name><con:value/></con:property><con:property><con:name>ip20</con:name><con:value/></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>e07c3d59-4ad1-494e-9fb5-5989d27a038b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>bcb0228b-1970-4979-9423-4eea885c56d9</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>512f5807-e3cb-4535-9f1e-c20e9f8faa71</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>29319c2c-c939-4b1c-8fdb-f3b0680a5ac9</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>74a97fc7-4445-429a-abbb-8585d5884e4b</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>83122393-40a4-451d-b8ed-32e3a894defc</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d2feb4ae-55e4-4410-9186-68580bb15541</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>263084aa-7ba3-40fa-a8d0-825346f2a846</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>4a3c40c8-cb86-40a9-b8c3-401c9224d619</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>a889929d-21b9-49ca-be1d-9dec72609888</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>080bdad0-b28e-4e15-86d1-60efeff397ae</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>68b00083-820a-4ecc-9ad9-8444cb409ae4</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase>