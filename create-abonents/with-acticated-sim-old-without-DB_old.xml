<?xml version="1.0" encoding="UTF-8"?>
<con:testCase failOnError="true" failTestCaseOnErrors="true" keepSession="false" maxResults="0" name="with acticated sim old without DB_old" searchProperties="true" id="8c844c9e-9a1d-4e71-badb-a1709654ff4c" disabled="true" xmlns:con="http://eviware.com/soapui/config"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.panels.testcase.JTestRunLog$OptionsForm@max_rows">1000</con:setting><con:setting id="com.eviware.soapui.impl.wsdl.panels.testcase.JTestRunLog$OptionsForm@errors_only">false</con:setting><con:setting id="8c844c9e-9a1d-4e71-badb-a1709654ff4cfileName">with-acticated-sim-old-without-DB_old</con:setting></con:settings><con:testStep type="groovy" name="data" id="3dfaa758-8b89-4d94-8fce-c6d53fc97153"><con:settings/><con:config><script>def date = new Date().format("yyyy-MM-dd");
testRunner.testCase.setPropertyValue("data", date.toString()  )

</script></con:config></con:testStep><con:testStep type="groovy" name="random" id="ffc72d14-d0e9-4ec6-9d77-88a05736d2ce"><con:settings/><con:config><script>testRunner.testCase.setPropertyValue("number", '')

def length = 9;
String validChars ="1234567890"
def rnd = new Random()

def number = '79'

	number = number.toInteger() +  ( (1..length).sum
{ 
validChars[ rnd.nextInt(validChars.length()) ]})

testRunner.testCase.setPropertyValue("number", number.toString()  )</script></con:config></con:testStep><con:testStep type="request" name="create" id="a8a36ea9-6a00-45f3-b833-be57169c186d"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorporateOrderManagementServiceSOAPBinding</con:interface><con:operation>createOrder</con:operation><con:request name="create" outgoingWss="" incomingWss="" timeout="" sslKeystore="" useWsAddressing="false" useWsReliableMessaging="false" wssPasswordType="" id="218a63dc-de6d-47f5-8abb-8158f95d1f31"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment xmlns:con="http://eviware.com/soapui/config">
  &lt;con:entry key="correlation-id" value="12312"/>
  &lt;con:entry key="Correlation-id" value="12313"/>
&lt;/xml-fragment></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2b}:8082/oms-web/OrderEndpoint</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ord="http://www.yota.ru/vox/b2b/services/order" xmlns:ns3="http://www.yota.ru/vox/b2b/domains/order">
   <soapenv:Header/>
   <soapenv:Body>
      <ord:CreateOrderRequest>
         <order createChannel="PublicPortal" orderStatus="yotaFulfill" orderStep="initialization" orderType="agreement" updateChannel="PublicPortal">
            <authorPhone>${#TestCase#number}</authorPhone>
            <orderChangeDate>${#TestCase#data}T00:00:00.000+03:00</orderChangeDate>
            <orderContent xsi:type="ns3:BaseAgreementOrder" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
               <needLinkRefSend>false</needLinkRefSend>
               <needReCall>false</needReCall>
            </orderContent>
         </order>
      </ord:CreateOrderRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" name="SOAP Response" id="a36013f1-90be-41b6-b3f0-e3fee8e167a5"/><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://www.yota.ru/vox/services/b2b/wsdl/CorporateOrderManagement/CreateOrder"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="check" id="09e51395-95da-413b-ad24-3ab0ac6fe56f"><con:settings/><con:config><script>def response = context.expand( '${create#Response#declare namespace ns2=\'http://www.yota.ru/vox/b2b/services/order\'; //ns2:CreateOrderResponse[1]/@resultStatus}' )

 
 if (response != 'new')
{
  testRunner.gotoStepByName("data")
}</script></con:config></con:testStep><con:testStep type="request" name="gener" id="7c309c3c-efcf-499f-9c3d-8c2ba5446207"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorporateOrderManagementServiceSOAPBinding</con:interface><con:operation>updateOrder</con:operation><con:request name="gener" outgoingWss="" incomingWss="" timeout="" sslKeystore="" useWsAddressing="false" useWsReliableMessaging="false" wssPasswordType="" id="f6d45253-a1fa-4299-abf6-2ddeb3cdff87"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2b}:8082/oms-web/OrderEndpoint</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ord="http://www.yota.ru/vox/b2b/services/order" xmlns:ns3="http://www.yota.ru/vox/b2b/domains/order">
   <soapenv:Header/>
   <soapenv:Body>
      <ord:UpdateOrderRequest>
         <action>portalLcGenerateContract</action>
         <order createChannel="PublicPortal" orderStatus="clientFulfill" orderStep="downloadingUploading" orderType="agreement" updateChannel="PublicPortal">
            <authorPhone>${create#Response#declare namespace ns2='http://www.yota.ru/vox/b2b/services/order'; //ns2:CreateOrderResponse[1]/order[1]/authorPhone[1]}</authorPhone>
            <linkRef>${create#Response#declare namespace ns2='http://www.yota.ru/vox/b2b/services/order'; //ns2:CreateOrderResponse[1]/order[1]/linkRef[1]}</linkRef>
            <orderChangeDate>${create#Response#declare namespace ns2='http://www.yota.ru/vox/b2b/services/order'; //ns2:CreateOrderResponse[1]/order[1]/orderChangeDate[1]}</orderChangeDate>
            <orderContent xsi:type="ns3:BaseAgreementOrder" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
               <agreementDate>2016-06-20T00:00:00.000Z</agreementDate>
               <agreementRegion>C_${#TestCase#region}</agreementRegion>
               <clientInfo>
                  <status>active</status>
                  <customerPurpose>COMMERCIAL</customerPurpose>
                  <marketingSegment>STANDARD</marketingSegment>
                  <addresses>
                     <livingPeriod>
                        <fromDate>2016-03-10T00:00:00.000+03:00</fromDate>
                     </livingPeriod>
                     <primary>true</primary>
                     <addressText>309508, РОССИЯ, БЕЛГОРОДСКАЯ ОБЛ., СТАРЫЙ ОСКОЛ Г., 8 МАРТА УЛ., 104</addressText>
                     <country>РОССИЯ</country>
                     <addressType>Legal</addressType>
                     <city>СТАРЫЙ ОСКОЛ Г.</city>
                     <house>104</house>
                     <region>БЕЛГОРОДСКАЯ ОБЛ.</region>
                     <street>8 МАРТА УЛ.</street>
                     <zipCode>309508</zipCode>
                  </addresses>
                  <CEO>
                     <emails>
                        <livingPeriod>
                           <fromDate>2000-02-01T00:00:00.000+03:00</fromDate>
                        </livingPeriod>
                        <rawSource>mnp3@mail.ru</rawSource>
                        <primary>true</primary>
                        <email>MNP3@MAIL.RU</email>
                        <emailType>Home</emailType>
                     </emails>
                     <personalDetails>
                        <gender>Male</gender>
                     </personalDetails>
                     <name>
                        <core:firstName xmlns:core="http://www.yota.ru/vox/domains/common/core">йцуйц</core:firstName>
                        <core:lastName xmlns:core="http://www.yota.ru/vox/domains/common/core">йцуйцуйцу</core:lastName>
                        <core:middleName xmlns:core="http://www.yota.ru/vox/domains/common/core">йцуйцуцй</core:middleName>
                     </name>
                     <position>Генеральный директор</position>
                     <role>CEO</role>
                  </CEO>
                  <companyRegistrationDate>2015-04-24T00:00:00.000+03:00</companyRegistrationDate>
                  <contactPerson>
                     <emails>
                        <livingPeriod>
                           <fromDate>2000-02-01T00:00:00.000+03:00</fromDate>
                        </livingPeriod>
                        <rawSource>mnp3@mail.ru</rawSource>
                        <primary>true</primary>
                        <email>MNP3@MAIL.RU</email>
                        <emailType>Home</emailType>
                     </emails>
                     <role>contactPerson</role>
                  </contactPerson>
                  <EGRULData>
                     <INN>1111</INN>
                     <KPP>773301001</KPP>
                     <OGRN>5077746887312</OGRN><OPF>12300.2014</OPF>
                     
                  </EGRULData>
                  <fullCompanyName>ООО ${#TestCase#number}</fullCompanyName>
                  <inactiveSIMlimit>25</inactiveSIMlimit>
                  <masterAgreement status="new" type="VOICE_B2B">
                     <administrator>
                        <emails>
                           <livingPeriod>
                              <fromDate>2000-02-01T00:00:00.000+03:00</fromDate>
                           </livingPeriod>
                           <rawSource>mnp3@mail.ru</rawSource>
                           <primary>true</primary>
                           <email>MNP3@MAIL.RU</email>
                           <emailType>Home</emailType>
                        </emails>
                        <phones>
                           <livingPeriod>
                              <fromDate>2017-01-17T00:00:00.000+04:00</fromDate>
                           </livingPeriod>
                           <primary>true</primary>
                           <phoneNumber>89811598423</phoneNumber>
                           <phoneType>Work</phoneType>
                        </phones>
                        <role>administrator</role>
                     </administrator>
                     <agreementCity>C_${#TestCase#region}</agreementCity>
                     <agreementMSISDN>79992119452</agreementMSISDN>
                     <agreementRegion>O_${#TestCase#region}</agreementRegion>
                     <billingAccountID>8204135</billingAccountID>
                     <contractType>direct</contractType>
                     <generationDate>2016-06-20T00:00:00.000+03:00</generationDate>
                     <saleChannel>PublicPortal</saleChannel>
                     <underWriter>
                        <emails>
                           <livingPeriod>
                              <fromDate>2000-02-01T00:00:00.000+03:00</fromDate>
                           </livingPeriod>
                           <rawSource>mnp3@mail.ru</rawSource>
                           <primary>true</primary>
                           <email>MNP3@MAIL.RU</email>
                           <emailType>Home</emailType>
                        </emails>
                        <role>underWriter</role>
                     </underWriter>
                  </masterAgreement><opf>12300.2014</opf>
                  
                  <shortCompanyName>${#TestCase#number}</shortCompanyName>
               </clientInfo>
               <needLinkRefSend>true</needLinkRefSend>
               <needReCall>false</needReCall>
               <simCount>${#TestCase#simlimit}</simCount>
            </orderContent>
            <orderCreateDate>${create#Response#declare namespace ns2='http://www.yota.ru/vox/b2b/services/order'; //ns2:CreateOrderResponse[1]/order[1]/orderCreateDate[1]}</orderCreateDate><orderId>${create#Response#declare namespace ns7='http://www.yota.ru/vox/b2b/services/order'; //ns7:CreateOrderResponse[1]/order[1]/orderId[1]}</orderId>
            
            <revision>3</revision>
            <shortLinkRef>${create#Response#declare namespace ns2='http://www.yota.ru/vox/b2b/services/order'; //ns2:CreateOrderResponse[1]/order[1]/shortLinkRef[1]}</shortLinkRef>
            <revision>1</revision>
         </order>
      </ord:UpdateOrderRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" name="SOAP Response" id="55159c70-4ebe-49c5-a54e-4b3e43ae1239"/><con:assertion type="XPath Match" name="Check for existance of [orderId]" id="08cefc2e-f72d-4e1b-a56d-8c5b93809d53"><con:configuration><path>declare namespace ns2='http://www.yota.ru/vox/b2b/services/order';
exists( //ns2:UpdateOrderResponse/orderId)</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508" action="http://www.yota.ru/vox/services/b2b/wsdl/CorporateOrderManagement/UpdateOrder"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="request" name="activate" id="8e0b061e-6006-4e3b-878e-87e9dfca49aa"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorporateOrderManagementServiceSOAPBinding</con:interface><con:operation>activateAgreement</con:operation><con:request name="activate" id="4ee87411-55d5-4bb5-9299-f70bf5f3dad7"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2b}:8082/oms-web/OrderEndpoint</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ord="http://www.yota.ru/vox/b2b/services/order">
   <soapenv:Header/>
   <soapenv:Body>
      <ord:ActivateAgreementRequest>
         <orderId>${gener#Response#declare namespace ns2='http://www.yota.ru/vox/b2b/services/order'; //ns2:UpdateOrderResponse[1]/orderId[1]}</orderId>
      </ord:ActivateAgreementRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="eed9a1c0-9fea-43a1-96d7-7a423fdcbc85"/><con:assertion type="XPath Match" name="Check for existance of [ns2:ActivateAgreementResponse]" id="f7ab97c5-f84b-4dd7-95d4-b16d4d26674c"><con:configuration><path>declare namespace ns2='http://www.yota.ru/vox/b2b/services/order';
exists( //ns2:ActivateAgreementResponse)</path><content>true</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="request" name="get" id="01ebcbf9-3c2c-4e74-852a-4479dba389b0"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorporateOrderManagementServiceSOAPBinding</con:interface><con:operation>getOrderById</con:operation><con:request name="get" id="4fb52ad4-8ab4-4a15-9777-1f8bfd584a68"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2b}:8082/oms-web/OrderEndpoint</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ord="http://www.yota.ru/vox/b2b/services/order">
   <soapenv:Header/>
   <soapenv:Body>
      <ord:GetOrderByIdRequest>
         <orderId>${gener#Response#declare namespace ns2='http://www.yota.ru/vox/b2b/services/order'; //ns2:UpdateOrderResponse[1]/orderId[1]}</orderId>
      </ord:GetOrderByIdRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="006986be-3e2f-41ca-adf0-fb77cafb90eb"/><con:assertion type="XPath Match" name="Match content of [@status]" id="7cb21dcc-5f85-490a-a8c1-997609f01042"><con:configuration><path>declare namespace ns2='http://www.yota.ru/vox/b2b/services/order';
//ns2:GetOrderByIdResponse[1]/order[1]/orderContent[1]/clientInfo[1]/masterAgreement[1]/@status</path><content>activated</content><allowWildcards>false</allowWildcards><ignoreNamspaceDifferences>false</ignoreNamspaceDifferences><ignoreComments>false</ignoreComments></con:configuration></con:assertion><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="result" id="3806a936-d3a8-4010-a7c0-f10de6a35eeb"><con:settings/><con:config><script><![CDATA[def billingid = context.expand( '${get#Response#declare namespace ns2=\'http://www.yota.ru/vox/b2b/services/order\'; //ns2:GetOrderByIdResponse[1]/order[1]/billingAccount[1]}' )
def path = context.expand( '${#TestCase#Path}' )
def startDate = new Date() 
def hostb2b = context.expand( '${#Project#host-b2b}' )
def hostb2c = context.expand( '${#Project#host-b2c}' )
def customerid = context.expand( '${get#Response#declare namespace ns2=\'http://www.yota.ru/vox/b2b/services/order\'; //ns2:GetOrderByIdResponse[1]/order[1]/customerId[1]}' )
def phone = context.expand( '${get#Response#declare namespace ns2=\'http://www.yota.ru/vox/b2b/services/order\'; //ns2:GetOrderByIdResponse[1]/order[1]/authorPhone[1]}' )
def linkref = context.expand( '${get#Response#declare namespace ns2=\'http://www.yota.ru/vox/b2b/services/order\'; //ns2:GetOrderByIdResponse[1]/order[1]/linkRef[1]}' )

def out= new File(path+'AccWithSim'+billingid+'.txt')

    out.createNewFile()
    out <<  '\n' +"Дата создания: "+startDate.format("yyyy-MM-dd'T'HH:mm:ss")  
    out <<  '\n'
    out <<  '\n' + "Окружение: "+ hostb2b + " и " + hostb2c
    out <<  '\n'
    out <<  '\n' + "Номер договора абонента: " + billingid
    out <<  '\n'
    out <<  '\n' + "Номер телефона абонента: " + phone
    out <<  '\n'
    out <<  '\n' + "customerid: " + customerid
    out <<  '\n'
    out <<  '\n'+ "LinkRef: " + linkref    
    out <<  '\n']]></script></con:config></con:testStep><con:testStep type="groovy" name="SetGlobal" id="79f0815b-9e54-4375-855c-0b6b8f3d7fc3"><con:settings/><con:config><script>def N = context.expand( '${#TestCase#N}' )
testRunner.testCase.setPropertyValue("N", "1" )
def billingID = context.expand( '${#TestCase#BillingID}' )
def bill = context.expand( '${get#Response#declare namespace ns2=\'http://www.yota.ru/vox/b2b/services/order\'; //ns2:GetOrderByIdResponse[1]/order[1]/billingAccount[1]}' )
testRunner.testCase.setPropertyValue("BillingID", bill )
testRunner.testCase.setPropertyValue("accountID", bill.substring(5) )


</script></con:config></con:testStep><con:testStep type="calltestcase" name="getVacantSim" id="49b94dd4-5064-461f-b276-1cef05b9ffe9"><con:settings/><con:config xsi:type="con:RunTestCaseStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:targetTestCase>f076452a-212f-4fee-921e-2d23f29a3408</con:targetTestCase><con:properties><con:property><con:name>iccid</con:name><con:value>0200435560</con:value></con:property><con:property><con:name>imsi</con:name><con:value>250110200435560</con:value></con:property><con:property><con:name>ip</con:name><con:value>10.56.56.28</con:value></con:property></con:properties><con:returnProperties><con:entry>iccid</con:entry><con:entry>imsi</con:entry><con:entry>ip</con:entry></con:returnProperties><con:runMode>PARALLELL</con:runMode></con:config></con:testStep><con:testStep type="request" name="extradition" id="b34fa1cf-0b4e-4cdb-ba17-89d2a8288cfc"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorporateOrderManagementServiceSOAPBinding</con:interface><con:operation>createOrder</con:operation><con:request name="extradition" id="63679b8c-f03b-48b3-bf27-792c37c54a44"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@bind_address"/></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2b}:8082/oms-web/OrderEndpoint</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ord="http://www.yota.ru/vox/b2b/services/order">
   <soapenv:Header/>
   <soapenv:Body>
      <ord:CreateOrderRequest>
         <order createChannel="RemoteDealer" orderStatus="complete" orderStep="initialization" orderType="SIMOrder" updateChannel="RemoteDealer">
            <billingAccount>${#TestCase#BillingID}</billingAccount>
            <orderChangeDate>2016-04-06T14:04:15.511+03:00</orderChangeDate>
            <orderContent xsi:type="ns641:SIMOrder" xmlns:ns641="http://www.yota.ru/vox/b2b/domains/corpSIMOrder" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
               <deliveredSims>
                  <branch/>
                  <simSpec>PHONELEGAL</simSpec>
                  <iccid>${getVacantSim#iccid}</iccid>
                  <saleChannel>RemoteDealer</saleChannel>
               </deliveredSims>
            </orderContent>
         </order>
      </ord:CreateOrderRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="8387a320-b9ff-41b5-b07f-d0c252b394ee"/><con:credentials><con:selectedAuthProfile>Basic</con:selectedAuthProfile><con:addedBasicAuthenticationTypes>Basic</con:addedBasicAuthenticationTypes><con:authType>Global HTTP Settings</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="groovy" name="checkExtradition" id="fd9d99e3-2d13-40a1-898a-7365b7cdffcb"><con:settings/><con:config><script>def ok = context.expand( '${extradition#Response#declare namespace ns2=\'http://www.yota.ru/vox/b2b/services/order\'; //ns2:CreateOrderResponse[1]/@resultStatus}' )

 if (ok != 'new')
{
  testRunner.gotoStepByName("getVacantSim")
}</script></con:config></con:testStep><con:testStep type="request" name="getSimPerson" id="40e2fb27-2c21-492a-926e-7d29fcaa9277"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorpCustomerInformationServiceSOAPBinding</con:interface><con:operation>getDeliveredSimByIccid</con:operation><con:request name="getSimPerson" id="49730b18-9baa-4a7c-8928-cf3ed52e1869"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2b}:8086/cis-web/CorpCustomerInformationServiceImpl</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cus="http://www.yota.ru/vox/b2b/services/customerInformation">
   <soapenv:Header/>
   <soapenv:Body>
      <cus:GetDeliveredSimByIccidRequest>
         <iccid>${extradition#Response#declare namespace ns7='http://www.yota.ru/vox/b2b/services/order'; //ns7:CreateOrderResponse[1]/order[1]/orderContent[1]/deliveredSims[1]/iccid[1]}</iccid>
      </cus:GetDeliveredSimByIccidRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="55cbee48-9c7e-4d12-8976-033e14fe2581"/><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="request" name="udpCorpPerson" id="3ab07f0b-009a-4dcd-8a7d-8cf94c8add8b"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorpCustomerInformationServiceSOAPBinding</con:interface><con:operation>updateCorporatePerson</con:operation><con:request name="udpCorpPerson" id="f9424cee-1b8e-4326-b466-91581038ca89"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2b}:8086/cis-web/CorpCustomerInformationServiceImpl</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:cus="http://www.yota.ru/vox/b2b/services/customerInformation" xmlns:core="http://www.yota.ru/vox/domains/common/core">
   <soapenv:Header/>
   <soapenv:Body>
      <cus:UpdateCorporatePersonRequest>
         <person hid="${getSimPerson#Response#declare namespace ns7='http://www.yota.ru/vox/b2b/services/customerInformation'; //ns7:GetDeliveredSimByIccidResponse[1]/sim[1]/holder[1]/@hid}" customerId="${getSimPerson#Response#declare namespace ns7='http://www.yota.ru/vox/b2b/services/customerInformation'; //ns7:GetDeliveredSimByIccidResponse[1]/sim[1]/holder[1]/@customerId}">
            <personalDetails>
               <gender>Male</gender>
               <birthDate>2018-06-02T00:00:00.000+04:00</birthDate>
               <birthPlace>Петербург</birthPlace>
            </personalDetails>
            <identififcation>
               <livingPeriod>
                  <fromDate>2018-06-05T00:00:00.000+04:00</fromDate>
               </livingPeriod>
              <identificationStatus>SUCCESS</identificationStatus>
               <attempt>2</attempt>
            </identififcation>
            <address>
               <livingPeriod>
                  <fromDate>2018-06-02T00:00:00.000+03:00</fromDate>
                  <untilTo>2018-06-02T00:00:00.000+03:00</untilTo>
               </livingPeriod>
               <addressText>Ставропольский край, г Кисловодск, ул Прудная</addressText>
               <addressType>SubscriberLocation</addressType>
               <country>РОССИЯ</country>
               <city>КИСЛОВОДСК</city>
               <region>СТАВРОПОЛЬСКИЙ</region>
               <street>ПРУДНАЯ</street>
            </address>
            <documentDetails>
               <livingPeriod>
                  <fromDate>2018-06-02T00:00:00.000+04:00</fromDate>
                  <untilTo>2018-06-02T00:00:00.000+04:00</untilTo>
               </livingPeriod>
               <documentType>PassportRU</documentType>
               <documentSeries>4005</documentSeries>
               <documentNumber>900056</documentNumber>
               <issueDate>2018-06-03T00:00:00.000+04:00</issueDate>
               <issueAuthority>УВД</issueAuthority>
               <departmentCode>876-374</departmentCode>
               <expiryDate>2018-06-04T00:00:00.000+04:00</expiryDate>
            </documentDetails>
            <position>директор</position>
            <role>CEO</role>
            <name>
               <core:firstName>Алексей</core:firstName>
               <core:lastName>Охрененикус</core:lastName>
               <core:middleName>Владимирович</core:middleName>
            </name>
         </person>
      </cus:UpdateCorporatePersonRequest>
   </soapenv:Body>
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="115a9b0a-adb5-4a09-8761-4b6334328266"/><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="request" name="activesims" id="1dfa272f-91e4-4850-9b16-1531e8ca6086" disabled="true"><con:settings/><con:config xsi:type="con:RequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:interface>CorporateOrderManagementServiceSOAPBinding</con:interface><con:operation>createOrder</con:operation><con:request name="activesims" id="3a57d09e-7c8c-48f3-a6cc-85970ec539d4"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:encoding>UTF-8</con:encoding><con:endpoint>http://${#Project#host-b2b}:8082/oms-web/OrderEndpoint</con:endpoint><con:request><![CDATA[<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:ord="http://www.yota.ru/vox/b2b/services/order">\r
   <soapenv:Header/>\r
   <soapenv:Body>\r
      <ord:CreateOrderRequest>\r
         <order createChannel="CRM" orderStatus="initiate" orderStep="initialization" orderType="SIMActivation" updateChannel="RemoteDealer">\r
            <billingAccount>${get#Response#declare namespace ns2='http://www.yota.ru/vox/b2b/services/order'; //ns2:GetOrderByIdResponse[1]/order[1]/billingAccount[1]}</billingAccount>\r
            <orderChangeDate>${#TestCase#data}T00:00:00.000+04:00</orderChangeDate>\r
            <orderContent xsi:type="ns577:SIMActivationOrder" xmlns:ns677="http://www.yota.ru/vox/b2b/domains/corpSIMOrder" xmlns:ns577="http://www.yota.ru/vox/b2b/domains/order" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\r
               <activatedUnits>\r
                  <packageCountMin>200</packageCountMin>\r
                  <destOptionCode>B2B-OP-MA2-SMS</destOptionCode>\r
                  <sim>\r
                     <branch/>\r
                     <simCodes>\r
                        <key>${getVacantSim#iccid}</key>\r
                        <type>iccid</type>\r
                     </simCodes>\r
                     <simSpec/>\r
                  </sim>\r
               </activatedUnits>\r
            </orderContent>\r
         </order>\r
      </ord:CreateOrderRequest>\r
   </soapenv:Body>\r
</soapenv:Envelope>]]></con:request><con:assertion type="SOAP Response" id="ec963fc6-fdfd-4076-aef3-d00218c0b24e"/><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:wsaConfig mustUnderstand="NONE" version="200508"/><con:wsrmConfig version="1.2"/></con:request></con:config></con:testStep><con:testStep type="restrequest" name="getExternalID" id="478f046e-6140-48ee-a5d5-4982ffb04118" disabled="true"><con:settings/><con:config service="Product Management API" resourcePath="/pm/v1/simcards" methodName="getSimCardsV1" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="getExternalID" id="9b2b825b-725b-4f28-b56c-0d3f9926ba7a" mediaType="application/json"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://${#Project#pm_api}:8080</con:endpoint><con:request/><con:originalUri>http://ft3-pm-api.g4lab.com/pm/v1/simcards</con:originalUri><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters>
  <con:entry key="accountId" value="${#TestCase#accountID}"/>
  <con:entry key="returnProducts" value="false"/>
  <con:entry key="imsi" value="25011${getVacantSim#iccid}"/>
  <con:entry key="returnPrices" value="false"/>
</con:parameters></con:restRequest></con:config></con:testStep><con:testStep type="restrequest" name="attrB2B-Unlim" id="1424921e-2fc7-470e-953d-cb394c92766d" disabled="true"><con:settings/><con:config service="Billing API" resourcePath="/bill/v1/subscriptions/{subscriptionId}/attr" methodName="setSubscriptionAttr" xsi:type="con:RestRequestStep" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:restRequest name="attrB2B-Unlim" id="7f3e2257-9ec8-477b-9939-26bc476a2f33" mediaType="application/json" postQueryString="false"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>http://${#Project#billapi}:8080</con:endpoint><con:request>{
   "attrId": "100207",
   "attrValue": "B2B-UNLIM"
}</con:request><con:originalUri>http://ft3-bil-api.g4lab.com/bill/v1/subscriptions/32337336/attr</con:originalUri><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><entry key="subscriptionId" value="${getExternalID#Response#$[0].externalId}" xmlns="http://eviware.com/soapui/config"/></con:parameters></con:restRequest></con:config></con:testStep><con:testStep type="groovy" name="List" id="39c4984f-84de-4691-aee6-a93498937073"><con:settings/><con:config><script>def billingid = context.expand( '${get#Response#declare namespace ns2=\'http://www.yota.ru/vox/b2b/services/order\'; //ns2:GetOrderByIdResponse[1]/order[1]/billingAccount[1]}' )
def icc_id = context.expand( '${getVacantSim#iccid}' )
def path = context.expand( '${#TestCase#Path}' )
def ip = context.expand( '${getVacantSim#ip}' )
def startDate = new Date() 

def out= new File(path+'AccWithSim'+billingid+'.txt')
 out &lt;&lt; '\n'+ "Дата выдачи: "+startDate.format("yyyy-MM-dd'T'HH:mm:ss")  +  " | ICCID: " + icc_id + " | IMSI: 25011"+ icc_id + " | ip адрес:  " + ip + " | сим активирована"  

    </script></con:config></con:testStep><con:testStep type="groovy" name="checkCount" id="00242b21-dc87-4149-af6f-458354138807"><con:settings/><con:config><script>def N = context.expand( '${#TestCase#N}' )
def SIMCount = context.expand( '${#TestCase#SIMCount}' )

 if (N != SIMCount)
{
	N = N.toInteger() + 1

	testRunner.testCase.setPropertyValue("N", N.toString() )

  testRunner.gotoStepByName("getVacantSim")
}</script></con:config></con:testStep><con:testStep type="httprequest" name="addMoney" id="d675f8a4-c24d-4ea1-8d65-b9e8bdd1ea49"><con:settings/><con:config method="GET" xsi:type="con:HttpRequest" id="04000f63-dd81-4952-b696-e70f794b0298" name="addMoney" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><con:settings><con:setting id="com.eviware.soapui.impl.wsdl.WsdlRequest@request-headers">&lt;xml-fragment/></con:setting></con:settings><con:endpoint>https://oxford-payment-gate.g4lab.com/adapters/cyber-proto/cyberplat</con:endpoint><con:request/><con:credentials><con:selectedAuthProfile>No Authorization</con:selectedAuthProfile><con:authType>No Authorization</con:authType></con:credentials><con:jmsConfig JMSDeliveryMode="PERSISTENT"/><con:jmsPropertyConfig/><con:parameters><con:parameter><con:name>action</con:name><con:value>payment</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>number</con:name><con:value>${getVacantSim#iccid}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>receipt</con:name><con:value>${= String receipt = new java.text.SimpleDateFormat("yyyyMMddhhmmss").format(new Date()+1).toString();}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>date</con:name><con:value>${= String currentDate = new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss").format(new Date()).toString();}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>amount</con:name><con:value>${#TestCase#money}</con:value><con:style>QUERY</con:style></con:parameter><con:parameter><con:name>type</con:name><con:value>2</con:value><con:style>QUERY</con:style></con:parameter></con:parameters></con:config></con:testStep><con:properties><con:property><con:name>SIMCount</con:name><con:value>15</con:value></con:property><con:property><con:name>N</con:name><con:value>1</con:value></con:property><con:property><con:name>Path</con:name><con:value>C:\Projects\!B2BTXT</con:value></con:property><con:property><con:name>BillingID</con:name><con:value>11220024007710</con:value></con:property><con:property><con:name>number</con:name><con:value>79596230808</con:value></con:property><con:property><con:name>data</con:name><con:value>2020-07-30</con:value></con:property><con:property><con:name>region</con:name><con:value>77</con:value></con:property><con:property><con:name>simlimit</con:name><con:value>800</con:value></con:property><con:property><con:name>accountID</con:name><con:value>024007710</con:value></con:property><con:property><con:name>money</con:name><con:value>20000</con:value></con:property></con:properties><con:reportParameters/><con:breakPoints><con:testStepId>18ede8e0-c948-4be5-9a01-faf62475ce23</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>17a458cb-d50c-466e-b37e-bf9afe1e3511</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ccd84e25-12fb-4a73-a718-9911f3b695c3</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>5c4490e6-8cd7-4d22-b335-502b53285fb9</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>701b8157-653c-4182-be99-323c9801a764</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>3287b16b-18ad-4996-b38c-9dd51b0c782e</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>6cbd5d5e-e099-458b-96ca-fafa3ae8a4fe</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>0d48d0a4-3401-4144-a559-7ea556fb346e</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>f819a3a8-c43a-46fe-a79e-50df37748d38</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>2135ae48-2833-4369-86e2-b2ad786b9148</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>03674dc7-86fb-4ff4-a0a5-5fbaff3473f8</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>76e19857-b832-46d9-8f8b-a6934854467c</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>f2117cd6-c418-49d7-b543-1e051af74c64</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>81cab15c-037d-4b6a-a8bb-2c5d4983429f</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>5a936783-114a-41f1-b69e-b1e5e9fb2a89</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>8c99e53a-24cf-45f6-973e-ebae20d2f961</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>6a65fe4b-d826-473b-b248-fe8a04091aab</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>1d14f8a5-3702-491a-a337-a0d52cd300de</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>aad7bcb7-1be8-448c-b353-04a286edd678</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>cc7ea6c1-3475-416d-a93e-3258d3678e25</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>1a637798-af4c-431b-9abf-0d7e6157227e</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>c4eb4bfd-75e9-4434-880f-ca8c1c1d0172</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>ba6f215d-40e2-4385-99a4-63fd8a71ebbf</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>1b52064b-ab87-4339-8516-640be4572193</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>4d1cbb32-d3dd-4c13-b683-5e0fd6a399fb</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>23ed6e75-f3b3-4977-ac07-b00a52f14f22</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>5d2d687c-a5fd-4c2b-98f0-40c8edffb9ed</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>d3662775-3d62-46a0-bd27-5d7f52a8fd87</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>10b2e7d3-636a-44c4-a559-67c665773dad</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>f854af11-bd63-48ae-807c-ff5a18cc74a7</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>e79c0ab4-8e73-436f-9a09-4df35484c046</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>24145341-1f55-4182-a1c6-580f7e21f7d9</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints><con:breakPoints><con:testStepId>8671c422-0c13-4598-af72-707182f8ba6c</con:testStepId><con:status>NONE</con:status><con:properties/></con:breakPoints></con:testCase>